# Features ç›®å½•æ¶æ„é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ“‹ ç°çŠ¶åˆ†æ

### 1. ç›®å½•ç»“æ„ç°çŠ¶

```
src/renderer/src/
â”œâ”€â”€ features/              # â“ é—®é¢˜ç›®å½•
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/  # User å®ä½“ç±»ï¼ˆåŒ…å«ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ types.ts   # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ store/         # Zustand storeï¼ˆè°ƒç”¨ APIï¼‰
â”‚   â””â”€â”€ chat/
â”‚       â”œâ”€â”€ domain/
â”‚       â”‚   â””â”€â”€ entities/  # Chat, Message å®ä½“ç±»ï¼ˆåŒ…å«ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚       â””â”€â”€ store/         # Zustand storeï¼ˆè°ƒç”¨ APIï¼‰
â”œâ”€â”€ pages/                 # è·¯ç”±é¡µé¢ï¼ˆView å±‚ï¼‰
â”œâ”€â”€ components/            # UI ç»„ä»¶
â””â”€â”€ infra/
    â””â”€â”€ api/               # API å®¢æˆ·ç«¯ï¼ˆIPC è°ƒç”¨ï¼‰
```

### 2. ä»£ç ä½¿ç”¨æƒ…å†µ

**å…³é”®å‘ç°ï¼šfeatures ç›®å½•ä¸­çš„ä»£ç å®é™…ä¸Šæ²¡æœ‰è¢«ä½¿ç”¨ï¼**

- âœ… `grep` æœç´¢æ˜¾ç¤ºï¼š**æ²¡æœ‰ä»»ä½•åœ°æ–¹ä» features å¯¼å…¥ä»£ç **
- âœ… `pages/` ä¸­çš„é¡µé¢ä½¿ç”¨ mock æ•°æ®ï¼Œæ²¡æœ‰ä½¿ç”¨ store
- âœ… `components/` ä¸­çš„ç»„ä»¶æ²¡æœ‰ä½¿ç”¨ features ä¸­çš„ entity
- âœ… `LoginPage.tsx` æ˜¯å ä½é¡µé¢ï¼Œæ²¡æœ‰å®é™…åŠŸèƒ½
- âœ… `ChatsPage.tsx` ä½¿ç”¨ç¡¬ç¼–ç çš„ mock æ•°æ®

### 3. Features ç›®å½•ä¸­çš„é—®é¢˜ä»£ç 

#### 3.1 Entity ç±»åŒ…å«ä¸šåŠ¡é€»è¾‘

```typescript
// features/auth/domain/entities/user.entity.ts
export class User {
  // âŒ ä¸šåŠ¡é€»è¾‘åœ¨ renderer ä¸­
  isOnline(): boolean {
    return this.status === 'online'
  }

  getLastSeenText(): string {
    // âŒ æ—¶é—´æ ¼å¼åŒ–é€»è¾‘åº”è¯¥åœ¨ main è¿›ç¨‹æˆ–å…±äº«å·¥å…·ä¸­
    if (this.isOnline()) return 'online'
    const diff = Date.now() - this.lastSeen
    // ... å¤æ‚çš„è®¡ç®—é€»è¾‘
  }
}
```

#### 3.2 Store åœ¨ Renderer ä¸­è½¬æ¢æ•°æ®

```typescript
// features/auth/store/auth.store.ts
login: async (credentials) => {
  const userTable = await authAPI.login(...)
  const user = User.fromTable(userTable)  // âŒ æ•°æ®è½¬æ¢åœ¨ renderer
  set({ user, isAuthenticated: true })
}
```

#### 3.3 æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆsnake_case â†’ camelCaseï¼‰

```typescript
// features/chat/domain/entities/chat.entity.ts
static fromTable(row: ChatTable): Chat {
  return new Chat(
    row.id,
    row.type,
    row.title,
    row.avatar_url,      // âŒ snake_case â†’ camelCase è½¬æ¢
    row.description,
    row.member_count,    // âŒ åº”è¯¥åœ¨ main è¿›ç¨‹å®Œæˆ
    // ...
  )
}
```

## ğŸ” æ ¹å› åˆ†æ

### æ ¹å›  1ï¼šæ¶æ„æ¨¡å¼æ··æ·†

**é—®é¢˜**ï¼šæ··æ·†äº†ä¼ ç»Ÿ Web åº”ç”¨å’Œ Electron åº”ç”¨çš„æ¶æ„æ¨¡å¼

| æ¶æ„æ¨¡å¼     | ä¼ ç»Ÿ Web åº”ç”¨                | Electron åº”ç”¨ï¼ˆå½“å‰é¡¹ç›®ï¼‰    |
| ------------ | ---------------------------- | ---------------------------- |
| **å‰ç«¯èŒè´£** | å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆfeaturesï¼‰ | ä»…è´Ÿè´£ UI å±•ç¤ºï¼ˆè–„å®¢æˆ·ç«¯ï¼‰   |
| **åç«¯èŒè´£** | æä¾› API æ¥å£                | åŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åº“æ“ä½œ |
| **æ•°æ®è½¬æ¢** | å‰ç«¯å¤„ç†                     | åº”è¯¥åœ¨ä¸»è¿›ç¨‹å®Œæˆ             |
| **ä¸šåŠ¡é€»è¾‘** | å‰ç«¯å¯ä»¥åŒ…å«                 | åº”è¯¥åœ¨ä¸»è¿›ç¨‹                 |

**å½“å‰ä»£ç çš„é—®é¢˜**ï¼š

- é‡‡ç”¨äº†ä¼ ç»Ÿ Web åº”ç”¨çš„ features æ¶æ„
- ä½† Electron åº”ç”¨ä¸­ï¼Œrenderer åº”è¯¥æ˜¯è–„å®¢æˆ·ç«¯
- å¯¼è‡´èŒè´£åˆ’åˆ†ä¸æ¸…

### æ ¹å›  2ï¼šèŒè´£åˆ’åˆ†ä¸æ¸…æ™°

**æ­£ç¡®çš„èŒè´£åˆ’åˆ†åº”è¯¥æ˜¯ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Process (ä¸»è¿›ç¨‹)                   â”‚
â”‚ - æ‰€æœ‰ä¸šåŠ¡é€»è¾‘                           â”‚
â”‚ - æ•°æ®åº“æ“ä½œ                             â”‚
â”‚ - æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆsnake_case â†’ camelCaseï¼‰â”‚
â”‚ - Entity ç±»å’Œæ–¹æ³•                        â”‚
â”‚ - è¿”å›ç»™ renderer çš„æ•°æ®åº”è¯¥æ˜¯æœ€ç»ˆæ ¼å¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ IPC (ç±»å‹å®‰å…¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Renderer Process (æ¸²æŸ“è¿›ç¨‹)              â”‚
â”‚ - UI ç»„ä»¶ï¼ˆpages, componentsï¼‰           â”‚
â”‚ - çŠ¶æ€ç®¡ç†ï¼ˆä»… UI çŠ¶æ€ï¼Œå¦‚ loadingï¼‰     â”‚
â”‚ - API è°ƒç”¨ï¼ˆinfra/apiï¼‰                  â”‚
â”‚ - ç›´æ¥ä½¿ç”¨ API è¿”å›çš„æ•°æ®ï¼Œæ— éœ€è½¬æ¢       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å½“å‰é”™è¯¯çš„èŒè´£åˆ’åˆ†ï¼š**

```
Main Process
  â†“ è¿”å› UserTable (snake_case)
Renderer Process
  â†“ features/auth/store è°ƒç”¨ API
  â†“ features/auth/domain/entities è½¬æ¢æ•°æ®
  â†“ User.fromTable() è½¬æ¢ä¸º User (camelCase)
  â†“ åŒ…å«ä¸šåŠ¡é€»è¾‘æ–¹æ³•
```

### æ ¹å›  3ï¼šARCHITECTURE.md æ–‡æ¡£ä¸å®ç°ä¸ä¸€è‡´

**æ–‡æ¡£ä¸­æè¿°ï¼š**

- features æ˜¯"3å±‚æ‰å¹³åŒ–æ¶æ„"
- domain å±‚åŒ…å«"ä¸šåŠ¡é€»è¾‘"
- store å±‚"å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå®ä½“å¯¹è±¡"

**å®é™…åº”è¯¥ï¼š**

- renderer åº”è¯¥æ˜¯è–„å®¢æˆ·ç«¯
- æ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨ main è¿›ç¨‹
- main è¿›ç¨‹è¿”å›çš„æ•°æ®åº”è¯¥æ˜¯æœ€ç»ˆæ ¼å¼ï¼Œæ— éœ€è½¬æ¢

### æ ¹å›  4ï¼šæœªä½¿ç”¨çš„ä»£ç 

- features ç›®å½•ä¸­çš„ä»£ç å®Œå…¨æ²¡æœ‰è¢«ä½¿ç”¨
- è¯´æ˜è¿™æ˜¯æ—©æœŸæ¶æ„è®¾è®¡ï¼Œä½†å®é™…å¼€å‘æ—¶æ²¡æœ‰é‡‡ç”¨
- å¯¼è‡´ä»£ç å†—ä½™å’Œæ¶æ„æ··ä¹±

## ğŸ¯ é—®é¢˜æ€»ç»“

### é—®é¢˜ 1ï¼šFeatures ç›®å½•åº”è¯¥å­˜åœ¨å—ï¼Ÿ

**ç­”æ¡ˆï¼šä¸åº”è¯¥å­˜åœ¨ï¼ˆè‡³å°‘ä¸åº”è¯¥ä»¥å½“å‰å½¢å¼å­˜åœ¨ï¼‰**

**ç†ç”±ï¼š**

1. **èŒè´£é‡å¤**ï¼šfeatures è¯•å›¾åœ¨ renderer ä¸­å®ç°ä¸šåŠ¡é€»è¾‘å±‚ï¼Œä½†ä¸šåŠ¡é€»è¾‘åº”è¯¥åœ¨ main è¿›ç¨‹
2. **æœªè¢«ä½¿ç”¨**ï¼šä»£ç ä¸­æ²¡æœ‰ä»»ä½•åœ°æ–¹ä½¿ç”¨ features
3. **æ¶æ„æ··ä¹±**ï¼šä¸ Electron åº”ç”¨çš„è–„å®¢æˆ·ç«¯æ¶æ„ç†å¿µå†²çª

### é—®é¢˜ 2ï¼šEntity ç­‰æ“ä½œåº”è¯¥åœ¨å“ªé‡Œï¼Ÿ

**ç­”æ¡ˆï¼šåº”è¯¥åœ¨ main è¿›ç¨‹ä¸­**

**ç†ç”±ï¼š**

1. Entity ç±»åŒ…å«ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚ `isOnline()`, `getLastSeenText()`ï¼‰
2. æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆsnake_case â†’ camelCaseï¼‰åº”è¯¥åœ¨ main è¿›ç¨‹å®Œæˆ
3. renderer åº”è¯¥ç›´æ¥ä½¿ç”¨ API è¿”å›çš„æœ€ç»ˆæ•°æ®æ ¼å¼

### é—®é¢˜ 3ï¼šRenderer ç›®å½•ç»“æ„é—®é¢˜

**å½“å‰ç»“æ„çš„é—®é¢˜ï¼š**

```
renderer/src/
â”œâ”€â”€ features/     # âŒ ä¸åº”è¯¥å­˜åœ¨ï¼ˆæˆ–åº”è¯¥é‡æ„ï¼‰
â”œâ”€â”€ pages/        # âœ… è§†å›¾å±‚
â”œâ”€â”€ components/   # âœ… UI ç»„ä»¶
â””â”€â”€ infra/        # âœ… API å®¢æˆ·ç«¯
```

**åº”è¯¥çš„ç»“æ„ï¼š**

```
renderer/src/
â”œâ”€â”€ pages/        # è·¯ç”±é¡µé¢
â”œâ”€â”€ components/   # UI ç»„ä»¶ï¼ˆbusiness + uiï¼‰
â”œâ”€â”€ stores/       # UI çŠ¶æ€ç®¡ç†ï¼ˆå¯é€‰ï¼Œä»… UI çŠ¶æ€ï¼‰
â””â”€â”€ infra/        # API å®¢æˆ·ç«¯
```

## ğŸ’¡ è§£å†³æ–¹æ¡ˆå»ºè®®

### æ–¹æ¡ˆ 1ï¼šå®Œå…¨ç§»é™¤ features ç›®å½•ï¼ˆæ¨èï¼‰

**ç†ç”±ï¼š**

- features ä»£ç æœªè¢«ä½¿ç”¨
- èŒè´£åº”è¯¥åœ¨ main è¿›ç¨‹
- ç®€åŒ–æ¶æ„ï¼Œç¬¦åˆ Electron è–„å®¢æˆ·ç«¯ç†å¿µ

**æ­¥éª¤ï¼š**

1. åˆ é™¤ `src/renderer/src/features/` ç›®å½•
2. å°† Entity ç±»ç§»åˆ° `src/main/` æˆ– `src/shared/`ï¼ˆå¦‚æœéœ€è¦è·¨è¿›ç¨‹å…±äº«ï¼‰
3. åœ¨ main è¿›ç¨‹çš„ service ä¸­å®Œæˆæ•°æ®è½¬æ¢
4. API è¿”å›çš„æ•°æ®åº”è¯¥æ˜¯æœ€ç»ˆæ ¼å¼ï¼ˆcamelCaseï¼‰

### æ–¹æ¡ˆ 2ï¼šé‡æ„ features ä¸ºçº¯ UI å±‚ï¼ˆä¸æ¨èï¼‰

å¦‚æœä¿ç•™ featuresï¼Œåº”è¯¥ï¼š

- ç§»é™¤æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- ç§»é™¤ Entity ç±»
- ä»…ä¿ç•™ UI ç»„ä»¶å’Œ UI çŠ¶æ€ç®¡ç†
- ä½†è¿™æ · features å°±å˜æˆäº† components çš„é‡å¤

### æ–¹æ¡ˆ 3ï¼šå°† Entity ç§»åˆ° sharedï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœ Entity éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ï¼š

- ç§»åˆ° `src/shared/domains/`
- ä½†ä¸šåŠ¡é€»è¾‘æ–¹æ³•åº”è¯¥åœ¨ main è¿›ç¨‹çš„ service ä¸­
- renderer åªä½¿ç”¨æ•°æ®ï¼Œä¸è°ƒç”¨ä¸šåŠ¡æ–¹æ³•

## ğŸ“ å»ºè®®çš„æ¶æ„

### Main Process

```
src/main/
â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â””â”€â”€ chat.service.ts
â”œâ”€â”€ domain/            # é¢†åŸŸå®ä½“ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦ï¼‰
â”‚   â””â”€â”€ entities/
â””â”€â”€ ipc/               # IPC handlers
```

### Renderer Process

```
src/renderer/src/
â”œâ”€â”€ pages/             # è·¯ç”±é¡µé¢
â”œâ”€â”€ components/        # UI ç»„ä»¶
â”‚   â”œâ”€â”€ business/     # ä¸šåŠ¡ç»„ä»¶
â”‚   â””â”€â”€ ui/           # é€šç”¨ UI ç»„ä»¶
â”œâ”€â”€ stores/           # UI çŠ¶æ€ç®¡ç†ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ auth.store.ts # ä»…ç®¡ç† UI çŠ¶æ€ï¼ˆloading, errorï¼‰
â”‚   â””â”€â”€ chat.store.ts
â””â”€â”€ infra/
    â””â”€â”€ api/          # API å®¢æˆ·ç«¯
```

### Shared

```
src/shared/
â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ database.ts   # æ•°æ®åº“è¡¨ç±»å‹
â”‚   â””â”€â”€ ipc.ts        # IPC åè®®ç±»å‹
â””â”€â”€ domains/         # é¢†åŸŸæ¨¡å‹ï¼ˆå¦‚æœéœ€è¦å…±äº«ï¼‰
    â””â”€â”€ chat/
        â””â”€â”€ model.ts  # çº¯æ•°æ®æ¨¡å‹ï¼Œæ— ä¸šåŠ¡é€»è¾‘
```

## âœ… ç»“è®º

1. **features ç›®å½•ä¸åº”è¯¥å­˜åœ¨**ï¼ˆè‡³å°‘ä¸åº”è¯¥ä»¥å½“å‰å½¢å¼ï¼‰
2. **æ‰€æœ‰ä¸šåŠ¡é€»è¾‘åº”è¯¥åœ¨ main è¿›ç¨‹**
3. **renderer åº”è¯¥æ˜¯è–„å®¢æˆ·ç«¯ï¼Œåªè´Ÿè´£ UI**
4. **æ•°æ®è½¬æ¢åº”è¯¥åœ¨ main è¿›ç¨‹å®Œæˆ**
5. **å½“å‰ features ä»£ç æœªè¢«ä½¿ç”¨ï¼Œå¯ä»¥å®‰å…¨åˆ é™¤**

å»ºè®®ï¼š**å®Œå…¨ç§»é™¤ features ç›®å½•ï¼Œé‡æ„ä¸ºç¬¦åˆ Electron è–„å®¢æˆ·ç«¯æ¶æ„çš„ç»“æ„**ã€‚
